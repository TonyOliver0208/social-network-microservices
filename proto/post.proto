syntax = "proto3";

package post;

service PostService {
  rpc CreatePost (CreatePostRequest) returns (PostResponse);
  rpc GetPostById (GetPostByIdRequest) returns (PostResponse);
  rpc UpdatePost (UpdatePostRequest) returns (PostResponse);
  rpc DeletePost (DeletePostRequest) returns (DeletePostResponse);
  rpc GetUserPosts (GetUserPostsRequest) returns (PostsListResponse);
  rpc GetFeed (GetFeedRequest) returns (PostsListResponse);
  rpc LikePost (LikePostRequest) returns (LikeResponse);
  rpc UnlikePost (UnlikePostRequest) returns (LikeResponse);
  rpc CreateComment (CreateCommentRequest) returns (CommentResponse);
  rpc GetComments (GetCommentsRequest) returns (CommentsListResponse);
  rpc DeleteComment (DeleteCommentRequest) returns (DeleteCommentResponse);
  
  // Tag operations
  rpc GetTags (GetTagsRequest) returns (TagsListResponse);
  rpc GetPopularTags (GetPopularTagsRequest) returns (TagsListResponse);
  rpc GetPostsByTag (GetPostsByTagRequest) returns (PostsListResponse);
  rpc CreateTag (CreateTagRequest) returns (TagResponse);
  
  // Question voting operations
  rpc VoteQuestion (VoteQuestionRequest) returns (VoteQuestionResponse);
  rpc GetQuestionVotes (GetQuestionVotesRequest) returns (QuestionVotesResponse);
  
  // Favorite operations
  rpc FavoriteQuestion (FavoriteQuestionRequest) returns (FavoriteQuestionResponse);
  rpc UnfavoriteQuestion (UnfavoriteQuestionRequest) returns (FavoriteQuestionResponse);
  rpc GetUserFavorites (GetUserFavoritesRequest) returns (FavoriteQuestionsListResponse);
}

message CreatePostRequest {
  string userId = 1;
  string content = 2;
  repeated string mediaUrls = 3;
  optional string visibility = 4;
  repeated string tags = 5;
}

message GetPostByIdRequest {
  string id = 1;
}

message UpdatePostRequest {
  string id = 1;
  string userId = 2;
  optional string content = 3;
  repeated string mediaUrls = 4;
}

message DeletePostRequest {
  string id = 1;
  string userId = 2;
}

message Author {
  string id = 1;
  string name = 2;
  optional string picture = 3;
  int32 reputation = 4;
}

message PostResponse {
  string id = 1;
  string userId = 2;
  string content = 3;
  repeated string mediaUrls = 4;
  int32 likesCount = 5;
  int32 commentsCount = 6;
  string visibility = 7;
  string createdAt = 8;
  string updatedAt = 9;
  optional Author author = 10;
  repeated TagResponse tags = 11;
  int32 upvotes = 12;
  int32 downvotes = 13;
  int32 totalVotes = 14; // upvotes - downvotes
  optional string userVote = 15; // "up", "down", or null
  bool isFavorited = 16; // Whether current user favorited this question
}

message DeletePostResponse {
  bool success = 1;
}

message GetUserPostsRequest {
  string userId = 1;
  int32 page = 2;
  int32 limit = 3;
}

message GetFeedRequest {
  string userId = 1;
  int32 page = 2;
  int32 limit = 3;
}

message PostsListResponse {
  repeated PostResponse posts = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message LikePostRequest {
  string postId = 1;
  string userId = 2;
}

message UnlikePostRequest {
  string postId = 1;
  string userId = 2;
}

message LikeResponse {
  bool success = 1;
  int32 likesCount = 2;
}

message CreateCommentRequest {
  string postId = 1;
  string userId = 2;
  string content = 3;
}

message CommentResponse {
  string id = 1;
  string postId = 2;
  string userId = 3;
  string content = 4;
  string createdAt = 5;
}

message GetCommentsRequest {
  string postId = 1;
  int32 page = 2;
  int32 limit = 3;
}

message CommentsListResponse {
  repeated CommentResponse comments = 1;
  int32 total = 2;
}

message DeleteCommentRequest {
  string id = 1;
  string userId = 2;
}

message DeleteCommentResponse {
  bool success = 1;
}

// Tag messages
message TagResponse {
  string id = 1;
  string name = 2;
  string description = 3;
  int32 questionsCount = 4;
  string createdAt = 5;
}

message GetTagsRequest {
  int32 page = 1;
  int32 limit = 2;
}

message GetPopularTagsRequest {
  int32 limit = 1;
}

message TagsListResponse {
  repeated TagResponse tags = 1;
  int32 total = 2;
}

message GetPostsByTagRequest {
  string tagName = 1;
  int32 page = 2;
  int32 limit = 3;
}

message CreateTagRequest {
  string name = 1;
  string description = 2;
}

// Question voting messages
message VoteQuestionRequest {
  string questionId = 1;
  string userId = 2;
  string voteType = 3; // "up" or "down" - toggle if same, change if different, remove if null
}

message VoteQuestionResponse {
  bool success = 1;
  int32 upvotes = 2;
  int32 downvotes = 3;
  int32 totalVotes = 4; // upvotes - downvotes
  optional string userVote = 5; // "up", "down", or null
}

message GetQuestionVotesRequest {
  string questionId = 1;
  optional string userId = 2; // Optional - to check user's vote
}

message QuestionVotesResponse {
  int32 upvotes = 1;
  int32 downvotes = 2;
  int32 totalVotes = 3;
  optional string userVote = 4; // "up", "down", or null if userId provided
}

// Favorite messages
message FavoriteQuestionRequest {
  string questionId = 1;
  string userId = 2;
  optional string listName = 3; // Optional list name, defaults to "default"
}

message UnfavoriteQuestionRequest {
  string questionId = 1;
  string userId = 2;
}

message FavoriteQuestionResponse {
  bool success = 1;
  bool isFavorited = 2;
}

message GetUserFavoritesRequest {
  string userId = 1;
  optional string listName = 2; // Optional filter by list
  int32 page = 3;
  int32 limit = 4;
}

message FavoriteQuestionItem {
  string id = 1;
  string questionId = 2;
  string listName = 3;
  string createdAt = 4;
  optional PostResponse question = 5; // Include the full question data
}

message FavoriteQuestionsListResponse {
  repeated FavoriteQuestionItem favorites = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}
